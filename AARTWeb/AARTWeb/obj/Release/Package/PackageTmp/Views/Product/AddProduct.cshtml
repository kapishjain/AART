
@{
    ViewBag.Title = "AddProduct";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

<script src="~/GeneralJscripts/TelerikScripts/jquery.min.js"></script>
<script src="~/GeneralJscripts/TelerikScripts/jszip.min.js"></script>
<script src="~/GeneralJscripts/TelerikScripts/kendo.all.min.js"></script>

<link href="~/GeneralJscripts/TelerikCSS/kendo.common.min.css" rel="stylesheet" />
<link href="~/GeneralJscripts/TelerikCSS/kendo.common.min.css" rel="stylesheet">
<link href="~/GeneralJscripts/TelerikCSS/kendo.rtl.min.css" rel="stylesheet">
<link href="~/GeneralJscripts/TelerikCSS/kendo.default.min.css" rel="stylesheet">
<link href="~/GeneralJscripts/TelerikCSS/kendo.default.mobile.min.css" rel="stylesheet">

<script type="text/javascript">

    $(document).ready(function () {
        var dataSource = new kendo.data.DataSource({
            pageSize: 20,

            autoSync: true,
            schema: {
                model: {
                    id: "ProductID",
                    fields: {
                        DocumentType: { defaultValue: { document_code: "Select Doc type", document_name: "Select Doc type" }, validation: { required: true } },
                        MainAuthor: { defaultValue: { user: "Select main Author", name: "Select main Author" }, validation: { required: true } },
                        ReviewPeriod: { type: "date", format: "MM/dd/yyyy", validation: { required: true } },
                        DLP: { type: "date", format: "MM/dd/yyyy", validation: { required: true } }
                    }
                }
            }
        });

        $("#grid").kendoGrid({
            dataSource: dataSource,
            pageable: true,
            height: 550,
            toolbar: [{ name: "create", text: "Add New Document" }],
            columns: [
                { field: "DocumentType", title: "Document Name", width: "180px", editor: categoryDropDownEditor, template: "#=DocumentType.document_name#" },
                { field: "MainAuthor", title: "Main Author", width: "180px", editor: categoryDropDownEditor1, template: "#=MainAuthor.name#" },
                { field: "ReviewPeriod", title: "Review period", format: "{0:MM/dd/yyyy 23:59:00}", width: "130px" },
                { field: "DLP", title: "DLP", format: "{0:MM/dd/yyyy  23:59:00}", width: "130px" },
                { command: "destroy", title: " ", width: "150px" }],
            editable: true
        });
    });

    function categoryDropDownEditor(container, options) {
        $('<input required name="' + options.field + '"/>')
            .appendTo(container)
            .kendoDropDownList({
                autoBind: false,
                dataTextField: "document_code",
                dataValueField: "document_name",
                dataSource: doctype
                //{
                //    type: "Get",
                //    transport: {
                //        read: "http://192.168.1.81:9810/api/DocumentType/GetallDocType"
                //    }
                //}
            });
    }
    function categoryDropDownEditor1(container, options) {
        $('<input required name="' + options.field + '"/>')
            .appendTo(container)
            .kendoDropDownList({
                autoBind: false,
                dataTextField: "user_name",
                dataValueField: "name",
                dataSource: alluser
                //{
                //    type: "Get",
                //    transport: {
                //        read: "http://192.168.1.81:9810/api/DocumentType/GetallDocType"
                //    }
                //}
            });
    }
    var doctype = [
        {
            "document_code": "PSUR",
            "document_name": "PSUR"
        },
        {
            "document_code": "PADER",
            "document_name": "PADER"
        },
        {
            "document_code": "PBRER",
            "document_name": "PBRER"
        },
        {
            "document_code": "DSUR",
            "document_name": "DSUR"
        },
        {
            "document_code": "RMP",
            "document_name": "RMP"
        },
        {
            "document_code": "REMS",
            "document_name": "REMS"
        }
    ];
    var alluser = [
        {
            "user_name": "S YSADMIN",
            "name": "SuperUser",
            "status": "Active",
            "email_id": "sysadmin@ancla@ancla.com",
            "phone_number": 9898989898,
            "is_locked": "UnLocked"
        },
        {
            "user_name": "Manager",
            "name": "Manager",
            "status": "Active",
            "email_id": "ancla@ancla.com",
            "phone_number": 9898989898,
            "is_locked": "UnLocked"
        },
        {
            "user_name": "ManualUser",
            "name": "Manual",
            "status": "In-Active",
            "email_id": "manual@gmail.com",
            "phone_number": 9874562103,
            "is_locked": "UnLocked"
        },
        {
            "user_name": "Author",
            "name": "Author",
            "status": "In-Active",
            "email_id": "author@ancla.com",
            "phone_number": 1212121212,
            "is_locked": "UnLocked"
        }
    ];

    function submitrecord() {
        // alert("hi");
        var docgrid = $("#grid").data("kendoGrid").dataSource.data();
          console.log(docgrid);
        //          alert(docgrid[0].DocumentType.document_code);

        //  //alert(data1);
        ////  alert(JSON.stringify(data1));
                  console.log(JSON.stringify(docgrid));

        var doc;
        for (var i = 0; i < docgrid.length; i++) {
            if (doc == null) {
                doc = "DocumentType :" + docgrid[i].DocumentType.document_code + "," + "MainAuthor:" + docgrid[i].MainAuthor.user_name + "," + "ReviewPeriod:" + docgrid[i].ReviewPeriod + "," + "DLP:" + docgrid[i].DLP;
            }
            else {
                doc = doc + "#^#" + "DocumentType :" + docgrid[i].DocumentType.document_code + "," + "MainAuthor:" + docgrid[i].MainAuthor.user_name + "," + "ReviewPeriod:" + docgrid[i].ReviewPeriod + "," + "DLP:" + docgrid[i].DLP;
            }

            //alert(doc); 
        }

        //alert(data[0].DocumentType.document_code);
        var serviceURL = 'http://localhost/AARTweb/Product/AddPrdctAndDoc';

        $.ajax({
            type: "POST",
            url: serviceURL,
            // data: JSON.stringify(data1),
            //data: { doc: doc },
            data: JSON.stringify({ productname: $('#productname').val(), productdesc: $('#productdesc').val(), docdtls: doc }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: successFunc,
            error: errorFunc
        });

        function successFunc(data, status) {
            alert("Records Inserted.");
        }

        function errorFunc() {
            alert('error');
        }
    }

</script>

<body>
    <h2>AddProduct</h2>


    <div>
        Product Name:- <input type="text" class="k-content" name="Product Name" placeholder="Product Name" id="productname"></br>
        Product Description:- <input type="text" class="k-content" name="Product Desc" placeholder="Product Desc" id="productdesc">

        <span></span>
    </div>

    <div id="grid"></div>
    <button id="submitbyn" onclick="submitrecord();" class="k-content k-primary">Submit</button>

</body>